(self.webpackChunkant_docs=self.webpackChunkant_docs||[]).push([[1517],{3905:function(e,n,t){"use strict";t.d(n,{Zo:function(){return p},kt:function(){return u}});var a=t(7294);function o(e,n,t){return n in e?Object.defineProperty(e,n,{value:t,enumerable:!0,configurable:!0,writable:!0}):e[n]=t,e}function i(e,n){var t=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);n&&(a=a.filter((function(n){return Object.getOwnPropertyDescriptor(e,n).enumerable}))),t.push.apply(t,a)}return t}function r(e){for(var n=1;n<arguments.length;n++){var t=null!=arguments[n]?arguments[n]:{};n%2?i(Object(t),!0).forEach((function(n){o(e,n,t[n])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):i(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))}))}return e}function s(e,n){if(null==e)return{};var t,a,o=function(e,n){if(null==e)return{};var t,a,o={},i=Object.keys(e);for(a=0;a<i.length;a++)t=i[a],n.indexOf(t)>=0||(o[t]=e[t]);return o}(e,n);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)t=i[a],n.indexOf(t)>=0||Object.prototype.propertyIsEnumerable.call(e,t)&&(o[t]=e[t])}return o}var l=a.createContext({}),c=function(e){var n=a.useContext(l),t=n;return e&&(t="function"==typeof e?e(n):r(r({},n),e)),t},p=function(e){var n=c(e.components);return a.createElement(l.Provider,{value:n},e.children)},d={inlineCode:"code",wrapper:function(e){var n=e.children;return a.createElement(a.Fragment,{},n)}},h=a.forwardRef((function(e,n){var t=e.components,o=e.mdxType,i=e.originalType,l=e.parentName,p=s(e,["components","mdxType","originalType","parentName"]),h=c(t),u=o,m=h["".concat(l,".").concat(u)]||h[u]||d[u]||i;return t?a.createElement(m,r(r({ref:n},p),{},{components:t})):a.createElement(m,r({ref:n},p))}));function u(e,n){var t=arguments,o=n&&n.mdxType;if("string"==typeof e||o){var i=t.length,r=new Array(i);r[0]=h;var s={};for(var l in n)hasOwnProperty.call(n,l)&&(s[l]=n[l]);s.originalType=e,s.mdxType="string"==typeof e?e:o,r[1]=s;for(var c=2;c<i;c++)r[c]=t[c];return a.createElement.apply(null,r)}return a.createElement.apply(null,t)}h.displayName="MDXCreateElement"},2091:function(e,n,t){"use strict";t.r(n),t.d(n,{frontMatter:function(){return s},metadata:function(){return l},toc:function(){return c},default:function(){return d}});var a=t(2122),o=t(9756),i=(t(7294),t(3905)),r=["components"],s={title:"Pinning",id:"pinning"},l={unversionedId:"access-the-sana/pinning",id:"access-the-sana/pinning",isDocsHomePage:!1,title:"Pinning",description:"Each Ant node is configured to reserve a certain amount of memory on your computer's hard drive to store and serve chunks within their neighbourhood of responsibility for other nodes in the Sana network. Once this alloted space has been filled, each Ant node deletes older chunks to make way for newer ones as they are uploaded by the network.",source:"@site/docs/access-the-sana/pinning.md",sourceDirName:"access-the-sana",slug:"/access-the-sana/pinning",permalink:"/docs/access-the-sana/pinning",editUrl:"https://github.com/ethsana/sana-docs/blob/master/sidebars.js/docs/access-the-sana/pinning.md",version:"current",frontMatter:{title:"Pinning",id:"pinning"}},c=[{value:"Local Pinning",id:"local-pinning",children:[{value:"Pin During Upload",id:"pin-during-upload",children:[]},{value:"Administer Pinned Content",id:"administer-pinned-content",children:[]}]},{value:"Global Pinning",id:"global-pinning",children:[]}],p={toc:c};function d(e){var n=e.components,t=(0,o.Z)(e,r);return(0,i.kt)("wrapper",(0,a.Z)({},p,t,{components:n,mdxType:"MDXLayout"}),(0,i.kt)("p",null,"Each Ant node is configured to reserve a certain amount of memory on your computer's hard drive to store and serve chunks within their ",(0,i.kt)("em",{parentName:"p"},"neighbourhood of responsibility")," for other nodes in the Sana network. Once this alloted space has been filled, each Ant node deletes older chunks to make way for newer ones as they are uploaded by the network."),(0,i.kt)("p",null,"Each time a chunk is accessed, it is moved back to the end of the deletion queue, so that regularly accessed content stays alive in the network and is not deleted by a node's garbage collection routine."),(0,i.kt)("p",null,"This, however, presents a problem for content which is important, but accessed seldom requested. In order to keep this content alive, Ant nodes provide a facility to ",(0,i.kt)("strong",{parentName:"p"},"pin")," important content so that it is not deleted."),(0,i.kt)("p",null,"There are two flavours of pinning, ",(0,i.kt)("em",{parentName:"p"},"local")," and ",(0,i.kt)("em",{parentName:"p"},"global"),"."),(0,i.kt)("h2",{id:"local-pinning"},"Local Pinning"),(0,i.kt)("p",null,"If a node operator wants to keep content so that it can be accessed only by local users of that node, via the ",(0,i.kt)("a",{parentName:"p",href:"/docs/api-reference/api-reference"},"APIs")," or Gateway, chunks can be ",(0,i.kt)("em",{parentName:"p"},"pinned")," either during upload, or retrospectively using the Sana reference."),(0,i.kt)("div",{className:"admonition admonition-caution alert alert--warning"},(0,i.kt)("div",{parentName:"div",className:"admonition-heading"},(0,i.kt)("h5",{parentName:"div"},(0,i.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,i.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"16",height:"16",viewBox:"0 0 16 16"},(0,i.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"}))),"caution")),(0,i.kt)("div",{parentName:"div",className:"admonition-content"},(0,i.kt)("p",{parentName:"div"},"Files pinned using local pinning will still not necessarily be available to the rest of the network. Read ",(0,i.kt)("a",{parentName:"p",href:"/docs/access-the-sana/pinning#global-pinning"},"global pinning")," to find out how to keep your files available to the whole of the sana."))),(0,i.kt)("h3",{id:"pin-during-upload"},"Pin During Upload"),(0,i.kt)("p",null,"To store content so that it will persist even when Ant's garbage collection routine is deleting old chunks, we simply pass the ",(0,i.kt)("inlineCode",{parentName:"p"},"Sana-Pin")," header set to ",(0,i.kt)("inlineCode",{parentName:"p"},"true")," when uploading."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},'curl -H "Sana-Pin: true" -H "Sana-Postage-Batch-Id: 78a26be9b42317fe6f0cbea3e47cbd0cf34f533db4e9c91cf92be40eb2968264"  --data-binary @bee.mp4 localhost:1633/bzz\\?bee.mp4\n')),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-json"},'{"reference":"1bfe7c3ce4100ae7f02b62e38d3e8d4c3a86ea368349614a87827402f20cbb30"}\n')),(0,i.kt)("h3",{id:"administer-pinned-content"},"Administer Pinned Content"),(0,i.kt)("p",null,"To check what content is currently pinned on your node, query the ",(0,i.kt)("inlineCode",{parentName:"p"},"pins")," endpoint of your Ant API:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"curl localhost:1633/pins\n")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-json"},'{"references":["1bfe7c3ce4100ae7f02b62e38d3e8d4c3a86ea368349614a87827402f20cbb30"]}\n')),(0,i.kt)("p",null,"or, to check for specific references:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"curl localhost:1633/pins/1bfe7c3ce4100ae7f02b62e38d3e8d4c3a86ea368349614a87827402f20cbb30\n")),(0,i.kt)("p",null,"A ",(0,i.kt)("inlineCode",{parentName:"p"},"404")," response indicates the content is not available."),(0,i.kt)("h4",{id:"unpinning-content"},"Unpinning Content"),(0,i.kt)("p",null,"If we later decide our content is no longer worth keeping, we can simply unpin it by sending a ",(0,i.kt)("inlineCode",{parentName:"p"},"DELETE")," request to the pinning endpoint using the same reference:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},'curl -XDELETE http://localhost:1633/pins/1bfe7c3ce4100ae7f02b62e38d3e8d4c3a86ea368349614a87827402f20cbb30\n``\n\n```json\n{"message":"OK","code":200}\n')),(0,i.kt)("p",null,"Now, when check again, we will get a ",(0,i.kt)("inlineCode",{parentName:"p"},"404")," error as the content is no longer pinned."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"curl localhost:1633/pins/1bfe7c3ce4100ae7f02b62e38d3e8d4c3a86ea368349614a87827402f20cbb30\n")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-json"},'{"message":"Not Found","code":404}\n')),(0,i.kt)("div",{className:"admonition admonition-info alert alert--info"},(0,i.kt)("div",{parentName:"div",className:"admonition-heading"},(0,i.kt)("h5",{parentName:"div"},(0,i.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,i.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,i.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"info")),(0,i.kt)("div",{parentName:"div",className:"admonition-content"},(0,i.kt)("p",{parentName:"div"},"Pinning and unpinning is possible for files (as in the example) and also the chunks, directories, and bytes endpoints. See the ",(0,i.kt)("a",{parentName:"p",href:"/docs/api-reference/api-reference"},"API")," documentation for more details."))),(0,i.kt)("h4",{id:"pinning-already-uploaded-content"},"Pinning Already Uploaded Content"),(0,i.kt)("p",null,"The previous example showed how we can pin content upon upload. It is also possible to pin content that is already uploaded and present in the sana."),(0,i.kt)("p",null,"To do so, we can send a ",(0,i.kt)("inlineCode",{parentName:"p"},"POST")," request including the sana reference to the files pinning endpoint."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},'curl -XPOST http://localhost:1633/pin/7b344ea68c699b0eca8bb4cfb3a77eb24f5e4e8ab50d38165e0fb48368350e8f\n``\n\n```json\n{"message":"OK","code":200}\n')),(0,i.kt)("p",null,"The ",(0,i.kt)("inlineCode",{parentName:"p"},"pin")," operation will attempt to fetch the content from the network if it is not available on the local node. "),(0,i.kt)("p",null,"Now, if we query our files pinning endpoint again, the pin counter will once again have been incremented."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"curl http://localhost:1633/pin/chunks/7b344ea68c699b0eca8bb4cfb3a77eb24f5e4e8ab50d38165e0fb48368350e8f\n")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-json"},'{"address":"7b344ea68c699b0eca8bb4cfb3a77eb24f5e4e8ab50d38165e0fb48368350e8f","pinCounter":1}\n')),(0,i.kt)("div",{className:"admonition admonition-warning alert alert--danger"},(0,i.kt)("div",{parentName:"div",className:"admonition-heading"},(0,i.kt)("h5",{parentName:"div"},(0,i.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,i.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"12",height:"16",viewBox:"0 0 12 16"},(0,i.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M5.05.31c.81 2.17.41 3.38-.52 4.31C3.55 5.67 1.98 6.45.9 7.98c-1.45 2.05-1.7 6.53 3.53 7.7-2.2-1.16-2.67-4.52-.3-6.61-.61 2.03.53 3.33 1.94 2.86 1.39-.47 2.3.53 2.27 1.67-.02.78-.31 1.44-1.13 1.81 3.42-.59 4.78-3.42 4.78-5.56 0-2.84-2.53-3.22-1.25-5.61-1.52.13-2.03 1.13-1.89 2.75.09 1.08-1.02 1.8-1.86 1.33-.67-.41-.66-1.19-.06-1.78C8.18 5.31 8.68 2.45 5.05.32L5.03.3l.02.01z"}))),"warning")),(0,i.kt)("div",{parentName:"div",className:"admonition-content"},(0,i.kt)("p",{parentName:"div"},"While the pin operation will attempt to fetch content from the network if it is not available locally, we advise you to ensure that the content is available locally before calling the pin operation. If the content, for whatever reason, is only fetched partially from the network, the pin operation only partly succeeds and leaves the internal administration of pinning in an inconsistent state."))),(0,i.kt)("h2",{id:"global-pinning"},"Global Pinning"),(0,i.kt)("p",null,(0,i.kt)("a",{parentName:"p",href:"/docs/access-the-sana/pinning#local-pinning"},"Local pinning")," ensures that your own node does not delete uploaded files. But other nodes that store your\nchunks (because they fall within their ",(0,i.kt)("em",{parentName:"p"},"neighbourhood of responsibility"),") may have deleted content that has not been accessed recently to make room for new chunks."),(0,i.kt)("div",{className:"admonition admonition-info alert alert--info"},(0,i.kt)("div",{parentName:"div",className:"admonition-heading"},(0,i.kt)("h5",{parentName:"div"},(0,i.kt)("span",{parentName:"h5",className:"admonition-icon"},(0,i.kt)("svg",{parentName:"span",xmlns:"http://www.w3.org/2000/svg",width:"14",height:"16",viewBox:"0 0 14 16"},(0,i.kt)("path",{parentName:"svg",fillRule:"evenodd",d:"M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"}))),"info")),(0,i.kt)("div",{parentName:"div",className:"admonition-content"},(0,i.kt)("p",{parentName:"div"},"For more info on how chunks are distributed, persisted and stored within the network, read"),(0,i.kt)("a",{href:"/the-book-of-sana.pdf",target:"_blank",rel:"noopener noreferrer"},"The Book of Sana")," .")),(0,i.kt)("p",null,"To keep this content alive, your Ant node can be configured to refresh this content when it is requested by other nodes in the network, using ",(0,i.kt)("strong",{parentName:"p"},"global pinning"),"."),(0,i.kt)("p",null,"First, we must start up our node with the ",(0,i.kt)("inlineCode",{parentName:"p"},"global-pinning-enable")," flag set."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"bee start\\\n  --verbosity 5 \\\n  --swap-endpoint https://stake.getblock.io/mainnet/?api_key=your-api-key \\\n  --global-pinning-enable \\\n  --debug-api-enable\n")),(0,i.kt)("p",null,"Next, we pin our file locally, as shown above."),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},'curl -H "Sana-Pin: true" --data-binary @bee.mp4 localhost:1633/bzz\\?bee.mp4\n')),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-json"},'{"reference":"7b344ea68c699b0eca8bb4cfb3a77eb24f5e4e8ab50d38165e0fb48368350e8f"}\n')),(0,i.kt)("p",null,"Now, when we distribute links to our files, we must also specify the\nfirst two bytes of our overlay address as the ",(0,i.kt)("em",{parentName:"p"},"target"),". If a chunk\nthat has already been garbage collected by its storer nodes is\nrequested, the storer node will send a message using\n",(0,i.kt)("a",{parentName:"p",href:"/docs/dapps-on-sana/pss"},"PSS")," to the sana neighbourhood defined by\nthis prefix, of which our node is a member."),(0,i.kt)("p",null,"Let's use the addresses API endpoint to find out our target prefix:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"curl -s http://localhost:1635/addresses | jq .overlay\n")),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},'"320ed0e01e6e3d06cab44c5ef85a0898e68f925a7ba3dc80ee614064bb7f9392"\n')),(0,i.kt)("p",null,"Finally, we take the first two bytes of our overlay address, ",(0,i.kt)("inlineCode",{parentName:"p"},"320e")," and include this when referencing our chunk:"),(0,i.kt)("pre",null,(0,i.kt)("code",{parentName:"pre",className:"language-bash"},"curl http://localhost:1633/bzz/7b344ea68c699b0eca8bb4cfb3a77eb24f5e4e8ab50d38165e0fb48368350e8f?targets=320e\n")),(0,i.kt)("p",null,"Now, even if our chunks are deleted, they will be repaired in the\nnetwork by our local Ant node and will always be available to the\nwhole sana!"))}d.isMDXComponent=!0}}]);